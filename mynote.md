å…©æ­¥é©Ÿï¼š

  1. extract.py â€” æ¯æ¬¡æ”¹ config
  è·‘ä¸€æ¬¡ï¼Œç”¢ç”Ÿç‰¹å¾µæª”åˆ°
  features/ï¼ˆæœ‰å¿«å–ï¼Œæ²’æ”¹çš„é¡åˆ¥è‡ªå‹•è·³éï¼‰
  2. infer.py â€” åƒ features/
  çš„ç‰¹å¾µè·‘åµæ¸¬ï¼Œä¸éœ€è¦ text/geo encoder


1. çµæ§‹è·Ÿæµç¨‹å¤ å¥½å—ï¼Ÿ                    
                                         
  æˆ‘è¦ºå¾—æ¶æ§‹è¨­è¨ˆæ˜¯ä¹¾æ·¨çš„ï¼Œå…©æ­¥åˆ†é›¢çš„æ ¸å¿ƒå¥½ 
  è™•æ˜¯ï¼š                                   
                                           
  - extract.py è¼‰å…¥ 3-4 å€‹å¼•æ“ï¼Œä½†åªè·‘ä¸€æ¬¡
  - infer.py åªè¼‰å…¥ 2 å€‹å¼•æ“ï¼ˆvision +
  decoderï¼‰ï¼Œæ¨è«–æ™‚å¾ˆè¼•

  ä½†æœ‰å€‹åœ°æ–¹å¯ä»¥æ›´å¥½ï¼šç¾åœ¨ extract
  é‚„æ˜¯è¦è¼‰å…¥å…¨éƒ¨ 3 å€‹å¼•æ“ï¼Œå³ä½¿ä½ åªç”¨ text
  promptã€‚ç†è«–ä¸Šå¯ä»¥æŒ‰éœ€è¼‰å…¥ï¼Œä½†è€ƒé‡åˆ°å®ƒåª
  è·‘ä¸€æ¬¡ï¼Œå½±éŸ¿ä¸å¤§ï¼Œå…ˆä¸éåº¦è¨­è¨ˆã€‚

  2. Image promptï¼ˆæ¯”å°åœ–ï¼‰æœ‰æ”¯æ´å—ï¼Ÿ

  ç¨‹å¼ç¢¼æœ‰å¯«é€²å»äº†ï¼Œä½†é‚„æ²’å¯¦æ¸¬éã€‚
  extract.py è£¡é¢çš„ _geo_features()
  å®Œæ•´å¯¦ä½œäº†ï¼š

  1. è®€åƒè€ƒåœ–ç‰‡ â†’ è·‘ vision encoder
  2. æ‹¿ fpn_feat_2 + fpn_pos_2 + boxes +
  labels â†’ è·‘ geometry encoder
  3. å¾—åˆ° geo features [1, N+1, 256]

  prompt_type: "both" çš„æƒ…æ³ä¹Ÿæœ‰è™•ç†ï¼ŒæœƒæŠŠ
  text features è·Ÿ geo features concat
  èµ·ä¾†ã€‚

  ä½†é€™éƒ¨åˆ†éœ€è¦ä½ æä¾›çœŸæ­£çš„åƒè€ƒåœ–ç‰‡æ‰èƒ½é©—è­‰
  ã€‚ ç›®å‰åªæœ‰ text prompt æ˜¯è·‘éç¢ºèª OK
  çš„ã€‚

  3. Multi-class one-time inferenceï¼Ÿ

  æ˜¯çš„ï¼Œæ‰€æœ‰ class åœ¨å–®æ¬¡ decoder forward
  pass å®Œæˆã€‚ æµç¨‹æ˜¯ï¼š

  Vision encoder: 1 æ¬¡  (~32ms)
           â†“
  FPN features â†’ GPU d2d copy è¤‡è£½ N ä»½
  (~1ms)
           â†“
  Decoder: 1 æ¬¡ï¼Œbatch=N  (~14ms)

  ä¸æ˜¯è·‘ N æ¬¡ decoderï¼Œæ˜¯é  batch
  ç¶­åº¦ä¸€æ¬¡æå®šã€‚æ‰€ä»¥ 2 class è·Ÿ 4 class
  å·®è·å¾ˆå°ã€‚

  4. N æ˜¯å›ºå®šçš„é‚„æ˜¯æµ®å‹•çš„ï¼Ÿ

  åŸ·è¡ŒæœŸé–“æ˜¯å›ºå®šçš„ã€‚ Pipeline.__init__
  çš„æ™‚å€™æ ¹æ“š config è£¡æœ‰å¹¾å€‹ class
  å°±é å…ˆåˆ†é…å¥½æ‰€æœ‰ GPU bufferï¼š

  - batch_fpn_gpuï¼šN ä»½ FPN
  - prompt_feat_gpuï¼š[N, P, 256]
  - out_gpuï¼š[N, 200, 288, 288] çš„ mask
  buffer ç­‰ç­‰

  é€™äº› buffer å¤§å°æ˜¯å¯«æ­»çš„ï¼Œæ”¹ N è¦é‡å•Ÿã€‚

  ä¸é decoder engine æœ¬èº«æ”¯æ´å‹•æ…‹
  batchï¼ˆå»ºå¼•æ“çš„æ™‚å€™ maxShapes è¨­åˆ°
  4ï¼‰ï¼Œæ‰€ä»¥æŠ€è¡“ä¸Šå¯ä»¥åšæˆå‹•æ…‹çš„ â€”
  ä½†è¦é‡æ–°åˆ†é…
  bufferï¼Œç›®å‰æ²’å¿…è¦åšé€™å€‹è¤‡é›œåº¦ã€‚

  5. TensorRT æ€éº¼è½‰çš„ï¼Ÿ

  æˆ‘æ²’æœ‰é‡æ–°è½‰ï¼Œå¼•æ“æ˜¯ä¹‹å‰å°±å»ºå¥½çš„ã€‚
  æ•´å€‹æµç¨‹æ˜¯ï¼š

  PyTorch æ¨¡å‹ (facebook/sam3)
         â†“
  export_onnx.py  â†’  4 å€‹ .onnx æª”
         â†“  (å®šç¾© dynamic_axes: batch,
  prompt_len, num_boxes)
  trtexec  â†’  4 å€‹ .engine æª”
         â†“  (æŒ‡å®š minShapes / optShapes /
  maxShapes)
  engines/ è£¡çš„ç¾æˆå¼•æ“

  export_onnx.py
  è£¡å®šç¾©äº†æ¯å€‹å¼•æ“çš„å‹•æ…‹è»¸ï¼Œä¾‹å¦‚ decoderï¼š

  - prompt_features: {0: "batch", 1:
  "prompt_len"}
  - prompt_mask: {0: "batch", 1:
  "prompt_len"}

  ç„¶å¾Œç”¨ trtexec å»ºå¼•æ“æ™‚æŒ‡å®šç¯„åœï¼Œä¾‹å¦‚
  batch æœ€å° 1ã€æœ€å¤§ 4ï¼Œprompt_len æœ€å°
  1ã€æœ€å¤§ 60ã€‚TensorRT
  å°±æœƒåœ¨é€™å€‹ç¯„åœå…§åšæœ€ä½³åŒ–ã€‚

  æ‰€ä»¥æˆ‘å€‘çš„ pipeline èƒ½ç”¨ä¸åŒçš„
  prompt_lenï¼ˆtext=32, geo å¯èƒ½=5,
  both=37ï¼‰ï¼Œéƒ½ä¸éœ€è¦é‡å»ºå¼•æ“ï¼Œåªè¦ä¸è¶…é
  60 å°±è¡Œã€‚




  è®“æˆ‘å…ˆææ¸…æ¥š config
  å¯¦éš›éœ€è¦ä»€éº¼è³‡è¨Šï¼Œå†ä¾†æƒ³ UI æ€éº¼åšã€‚

â— Read 3 files (ctrl+o to expand)    

â— å¥½ï¼Œæˆ‘è®€å®Œ extract.py                  
  äº†ã€‚è®“æˆ‘æ•´ç†æ¸…æ¥šå†çµ¦ä½ å»ºè­°ã€‚           
                                         
  å„ prompt type éœ€è¦çš„æ¬„ä½              
        
  text é¡åˆ¥ï¼š                            
    name:        "person"           â†    
  é¡åˆ¥åç¨±
    prompt_type: "text"
    text:        "person"           â†
  æ–‡å­—æè¿°

  image é¡åˆ¥ï¼š
    name:        "my_cup"
    prompt_type: "image"
    references:                     â†
  å¯ä»¥å¤šå¼µåƒè€ƒåœ–
      - image:   "references/cup.jpg"
  â† åœ–ç‰‡è·¯å¾‘ï¼ˆç›¸å° config.jsonï¼‰
        boxes:   [[cx, cy, w, h], ...]
  â† æ­£è¦åŒ– cxcywh (0~1)
        labels:  [1, 0, ...]            â†
   1=æ­£æ¨£æœ¬, 0=è² æ¨£æœ¬

  both é¡åˆ¥ï¼š
    text + references å…©å€‹éƒ½æœ‰ï¼Œfeatures
  ä¸²æ¥

  ç—›é»åˆ†æ
  æ“ä½œ: åŠ  text é¡åˆ¥
  ç›´æ¥ç·¨ config.json: ç°¡å–®ï¼Œå¡« name +
  text
  ç”¨ UI: ä¹Ÿç°¡å–®ï¼Œä½†æ–¹ä¾¿ä¸€é»
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â”€
  æ“ä½œ: åŠ  image é¡åˆ¥
  ç›´æ¥ç·¨ config.json: å¾ˆç—›ï¼šè¦æ‰‹å‹•ç®—
  cxcywh
    æ­£è¦åŒ–åº§æ¨™
  ç”¨ UI: æ»‘é¼ æ‹‰æ¡†ï¼Œè‡ªå‹•ç®—
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â”€
  æ“ä½œ: çœ‹æ¡†å°ä¸å°
  ç›´æ¥ç·¨ config.json: æ²’è¾¦æ³•çœ‹
  ç”¨ UI: å³æ™‚é è¦½
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â”€
  æ“ä½œ: æ”¹ confidence
  ç›´æ¥ç·¨ config.json: ç°¡å–®
  ç”¨ UI: ç°¡å–®
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â”€
  æ“ä½œ: ä¸Šé™æª¢æŸ¥
  ç›´æ¥ç·¨ config.json: è‡ªå·±ç®—
  ç”¨ UI: UI æ“‹ä½ï¼ˆmax 4 class, 20 boxes
  æ ¸å¿ƒåƒ¹å€¼åœ¨ image prompt çš„æ¡†é¸ã€‚Text
  åªæ˜¯é †ä¾¿ã€‚

  æˆ‘çš„å»ºè­°ï¼šä¸€å€‹ config_editor.py

  sam3_pipeline/
  â”œâ”€â”€ config_editor.py    â†
  æ–°å¢ï¼Œç¨ç«‹å·¥å…·
  â”œâ”€â”€ config.json         â† è®€å– + è¼¸å‡º
  â”œâ”€â”€ references/         â† åœ–ç‰‡ä¾†æº
  â””â”€â”€ ...                 â† æ ¸å¿ƒä¸å‹•

  æŠ€è¡“é¸æ“‡ï¼šPython å…§å»º http.server +
  å–®ä¸€åµŒå…¥å¼ HTML

  ç‚ºä»€éº¼ä¸ç”¨ Flask/Tkinterï¼š
  - Flaskï¼šDocker è£¡å¯èƒ½æ²’è£ï¼Œå¤šä¸€å€‹
  dependency
  - Tkinterï¼šDocker è£¡é€šå¸¸æ²’æœ‰ï¼Œè€Œä¸”
  remote server æ²’ X11
  - å…§å»º http.serverï¼šé›¶
  dependencyï¼Œç€è¦½å™¨é–‹
  localhost:8080ï¼ŒSSH å¯ä»¥ port forward

  åŠŸèƒ½è¨­è¨ˆï¼š

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  SAM3 Config Editor          [Save
  config.json] â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚              â”‚
             â”‚
  â”‚  Classes     â”‚    Canvas (reference
  image)      â”‚
  â”‚  â”€â”€â”€â”€â”€â”€      â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  + Add class â”‚    â”‚
      â”‚      â”‚
  â”‚              â”‚    â”‚   æ‹‰æ¡† â†’ è‡ªå‹•ç®—
        â”‚      â”‚
  â”‚  [person]    â”‚    â”‚   cxcywh + label
       â”‚      â”‚
  â”‚   type: text â”‚    â”‚
      â”‚      â”‚
  â”‚   text: ...  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚              â”‚
             â”‚
  â”‚  [my_cup]    â”‚    Boxes:
             â”‚
  â”‚   type:image â”‚    [0.52, 0.48, 0.31,
  0.42] âœ…  â”‚
  â”‚   refs: 2    â”‚    [0.10, 0.20, 0.15,
  0.12] âŒ  â”‚
  â”‚              â”‚
             â”‚
  â”‚  confidence: â”‚    References:
             â”‚
  â”‚  [0.3]       â”‚    ğŸ“
  references/ä¸­è¯æ±½è»Š/       â”‚
  â”‚              â”‚       image1.jpg
  [Select]       â”‚
  â”‚              â”‚       image2.png
  [Select]       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  é—œéµåŠŸèƒ½ï¼š
  1. å·¦å´ï¼šclass åˆ—è¡¨ï¼Œå¯æ–°å¢/åˆªé™¤/åˆ‡æ›
  text/image/both
  2. å³å´ï¼šé¸ reference åœ–ç‰‡ â†’ åœ¨ canvas
  ä¸Šæ‹‰æ¡† â†’ è‡ªå‹•è¨ˆç®—æ­£è¦åŒ– cxcywh
  3. æ¯å€‹æ¡†å¯ä»¥åˆ‡
  positive(ç¶ )/negative(ç´…)
  4. Save â†’ ç›´æ¥å¯«
  config.jsonï¼ˆä¿æŒåŸæœ‰æ ¼å¼ï¼‰
  5. Load â†’ é–‹å•Ÿæ™‚è®€ç¾æœ‰
  config.jsonï¼Œæ¡†ç•«å›å»

  ä¸ç¢°çš„æ±è¥¿ï¼š
  - extract.pyã€infer.py å®Œå…¨ä¸å‹•
  - ä¸éœ€è¦ GPUã€ä¸éœ€è¦ Docker
  - åœ¨ host æ©Ÿå™¨ä¸Šè·‘å°±å¥½ï¼ˆpython3
  config_editor.pyï¼‰

  ä¸€å€‹æª”æ¡ˆã€é›¶ dependencyã€ç”¨å®Œå°±é—œã€‚

  è¦æˆ‘ç…§é€™å€‹æ–¹å‘å¯¦ä½œå—ï¼Ÿ

âœ» Baked for 1m 12s


â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ Plan to implement                     â”‚
â”‚                                       â”‚
â”‚ SAM3 Pipeline â€” Config Editor UI      â”‚
â”‚                                       â”‚
â”‚ Context                               â”‚
â”‚                                       â”‚
â”‚ The SAM3 pipeline uses config.json to â”‚
â”‚  define detection classes. Text       â”‚
â”‚ prompts are easy to edit by hand, but â”‚
â”‚  image prompts require normalized     â”‚
â”‚ cxcywh bounding box coordinates       â”‚
â”‚ ([center_x, center_y, width, height], â”‚
â”‚  0.0â€“1.0) which are impractical to    â”‚
â”‚ write manually. We need a visual tool â”‚
â”‚  to draw bboxes on reference images   â”‚
â”‚ and auto-compute the coordinates.     â”‚
â”‚                                       â”‚
â”‚ This must be completely standalone â€”  â”‚
â”‚ a single Python file with zero        â”‚
â”‚ external dependencies, no impact on   â”‚
â”‚ the core pipeline.                    â”‚
â”‚                                       â”‚
â”‚ New File                              â”‚
â”‚                                       â”‚
â”‚ sam3_pipeline/config_editor.py â€”      â”‚
â”‚ single file, ~800-1000 lines (Python  â”‚
â”‚ server + embedded HTML/CSS/JS)        â”‚
â”‚                                       â”‚
â”‚ Architecture                          â”‚
â”‚                                       â”‚
â”‚ config_editor.py                      â”‚
â”‚ â”œâ”€â”€ Python (http.server)              â”‚
â”‚ â”‚   â”œâ”€â”€ GET  /              â†’ serves  â”‚
â”‚ embedded HTML page                    â”‚
â”‚ â”‚   â”œâ”€â”€ GET  /api/config    â†’ returns â”‚
â”‚  config.json contents                 â”‚
â”‚ â”‚   â”œâ”€â”€ POST /api/config    â†’ saves   â”‚
â”‚ config.json (receives full JSON)      â”‚
â”‚ â”‚   â”œâ”€â”€ GET  /api/referencesâ†’ lists   â”‚
â”‚ all images under references/          â”‚
â”‚ (recursive)                           â”‚
â”‚ â”‚   â””â”€â”€ GET  /file/<path>   â†’ serves  â”‚
â”‚ image files from references/          â”‚
â”‚ â””â”€â”€ HTML/CSS/JS (embedded string)     â”‚
â”‚     â”œâ”€â”€ Sidebar: class list +         â”‚
â”‚ add/delete buttons                    â”‚
â”‚     â”œâ”€â”€ Main area: class editor       â”‚
â”‚ (switches by prompt_type)             â”‚
â”‚     â””â”€â”€ Canvas: draw/edit bboxes on   â”‚
â”‚ reference images                      â”‚
â”‚                                       â”‚
â”‚ Run: python3 config_editor.py         â”‚
â”‚ --config config.json â†’ opens          â”‚
â”‚ http://localhost:8080                 â”‚
â”‚                                       â”‚
â”‚ UI Layout (Dark Theme)                â”‚
â”‚                                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚ â”‚  SAM3 Config Editor                 â”‚
â”‚           [Save]     â”‚                â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
â”‚ â”‚ Classes  â”‚  Class: person           â”‚
â”‚                      â”‚                â”‚
â”‚ â”‚          â”‚  Type: [text â–¾]          â”‚
â”‚                      â”‚                â”‚
â”‚ â”‚ + person â”‚  Text: [person        ]  â”‚
â”‚                      â”‚                â”‚
â”‚ â”‚   hand   â”‚                          â”‚
â”‚                      â”‚                â”‚
â”‚ â”‚          â”‚  â”€â”€ or (when             â”‚
â”‚ type=image/both) â”€â”€             â”‚     â”‚
â”‚ â”‚ [+ Add]  â”‚  References:             â”‚
â”‚                      â”‚                â”‚
â”‚ â”‚          â”‚                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Boxes:   â”‚
â”‚        â”‚                              â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚                       â”‚
â”‚    â”‚  [0.50,0.50,    â”‚                â”‚
â”‚ â”‚ Conf:0.3 â”‚  â”‚   (canvas with image  â”‚
â”‚    â”‚   0.30,0.40]   â”‚                 â”‚
â”‚ â”‚          â”‚  â”‚    + drawn bboxes)    â”‚
â”‚    â”‚   label: pos âœ“  â”‚                â”‚
â”‚ â”‚          â”‚  â”‚                       â”‚
â”‚    â”‚  [Delete]        â”‚               â”‚
â”‚ â”‚          â”‚                          â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚        â”‚                              â”‚
â”‚ â”‚          â”‚  Image:                  â”‚
â”‚ [references/cup.jpg â–¾]  [+ Add Ref]   â”‚
â”‚ â”‚                                     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                       â”‚
â”‚ Config Fields (from extract.py)       â”‚
â”‚                                       â”‚
â”‚ Top-level: engines, tokenizer,        â”‚
â”‚ features, confidence                  â”‚
â”‚ Per class:                            â”‚
â”‚ Field: name                           â”‚
â”‚ text: required                        â”‚
â”‚ image: required                       â”‚
â”‚ both: required                        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ â”€â”€â”€                                   â”‚
â”‚ Field: prompt_type                    â”‚
â”‚ text: "text"                          â”‚
â”‚ image: "image"                        â”‚
â”‚ both: "both"                          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ â”€â”€â”€                                   â”‚
â”‚ Field: text                           â”‚
â”‚ text: required                        â”‚
â”‚ image: â€”                              â”‚
â”‚ both: required                        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ â”€â”€â”€                                   â”‚
â”‚ Field: references                     â”‚
â”‚ text: â€”                               â”‚
â”‚ image: required                       â”‚
â”‚ both: required                        â”‚
â”‚ Reference format: {"image":           â”‚
â”‚ "references/cup.jpg", "boxes":        â”‚
â”‚ [[cx,cy,w,h], ...], "labels": [1,     â”‚
â”‚ ...]}                                 â”‚
â”‚                                       â”‚
â”‚ - Boxes: normalized cxcywh (0.0â€“1.0)  â”‚
â”‚ - Labels: 1=positive, 0=negative      â”‚
â”‚ - Max 4 classes, max 20 boxes per     â”‚
â”‚ class                                 â”‚
â”‚                                       â”‚
â”‚ Canvas Bbox Drawing                   â”‚
â”‚                                       â”‚
â”‚ 1. User selects a reference image     â”‚
â”‚ from dropdown (populated from         â”‚
â”‚ /api/references)                      â”‚
â”‚ 2. Image rendered on HTML canvas      â”‚
â”‚ (scaled to fit, aspect ratio          â”‚
â”‚ preserved)                            â”‚
â”‚ 3. Click-drag to draw bbox â†’ green    â”‚
â”‚ rectangle appears                     â”‚
â”‚ 4. On mouseup: compute normalized     â”‚
â”‚ cxcywh from pixel coords:             â”‚
â”‚ cx = (x1 + x2) / 2 / img_width        â”‚
â”‚ cy = (y1 + y2) / 2 / img_height       â”‚
â”‚ w  = abs(x2 - x1) / img_width         â”‚
â”‚ h  = abs(y2 - y1) / img_height        â”‚
â”‚ 5. Each box gets a label toggle       â”‚
â”‚ (positive/negative) and delete button â”‚
â”‚ 6. Existing boxes rendered as         â”‚
â”‚ coloured rectangles on canvas         â”‚
â”‚                                       â”‚
â”‚ Implementation Details                â”‚
â”‚                                       â”‚
â”‚ - Server: http.server.HTTPServer +    â”‚
â”‚ custom BaseHTTPRequestHandler         â”‚
â”‚ - HTML/CSS/JS: single string constant â”‚
â”‚  embedded in Python, served via GET / â”‚
â”‚ - Config path resolved from --config  â”‚
â”‚ CLI arg (default: config.json in same â”‚
â”‚  dir)                                 â”‚
â”‚ - All paths in config stored relative â”‚
â”‚  to config.json's parent directory    â”‚
â”‚ - Image serving: only files under     â”‚
â”‚ references/ are servable (security)   â”‚
â”‚ - Port: 8080 (configurable via        â”‚
â”‚ --port)                               â”‚
â”‚                                       â”‚
â”‚ Verification                          â”‚
â”‚                                       â”‚
â”‚ # 1. Start editor                     â”‚
â”‚ python3 /home/ubuntu/Documents/willy/ â”‚
â”‚ repos/william/VisionDSL/models/sam3_p â”‚
â”‚ ipeline/config_editor.py \            â”‚
â”‚   --config /home/ubuntu/Documents/wil â”‚
â”‚ ly/repos/william/VisionDSL/models/sam â”‚
â”‚ 3_pipeline/config.json                â”‚
â”‚                                       â”‚
â”‚ # 2. Open http://localhost:8080 in    â”‚
â”‚ browser                               â”‚
â”‚ # 3. Verify: existing 3 text classes  â”‚
â”‚ load correctly                        â”‚
â”‚ # 4. Test: add new class, change type â”‚
â”‚  to image, select reference image,    â”‚
â”‚ draw bbox                             â”‚
â”‚ # 5. Test: save â†’ verify config.json  â”‚
â”‚ updated                               â”‚
â”‚ # 6. Test: reload page â†’ verify saved â”‚
â”‚  state persists                       â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯


   ä½¿ç”¨æƒ…å¢ƒï¼š                           
  æ–‡å­—ä¸å¤ ç²¾ç¢ºçš„æ™‚å€™ã€‚ä¾‹å¦‚ä½              
                                         
  åµæ¸¬çš„æ˜¯ã€ŒæŸä¸€æ¬¾ç‰¹å®šçš„æ¯å­ã€ï¼Œå…‰èªª     
    "cup"                                
  å¤ªå»£æ³›ï¼Œä½†åŠ ä¸Šä¸€å¼µå¯¦æ‹ç…§ç‰‡æ¡†å‡ºä¾†       
    ï¼Œæ¨¡å‹å°±èƒ½åŒæ™‚ç”¨èªç¾©å’Œå¤–è§€ä¾†é–å®š     
  ç›®æ¨™



  ç¾ç‹€åˆ†æ

  ä½ çš„ SAM3 pipeline æœ‰å…©å€‹ TensorRT engineï¼Œæ¯ä¸€å¹€çš„è™•ç†æµç¨‹ï¼š

  Vision Encoder (~32ms)  â†’  FPN d2d copy (~1ms)  â†’  Decoder (~14ms)
         â†“                                                â†“
    è¼¸å…¥: [1, 3, 1008, 1008]                      è¼¸å…¥: [N, 256, 288, 288] ...
    1 å¼µåœ–                                        N = class æ•¸ï¼ˆç›®å‰ batch ç¶­åº¦çµ¦ class ç”¨ï¼‰

  å–®å¹€ ~47ms â†’ ~21 FPS ç†è«–å€¼ï¼Œä½ å¯¦æ¸¬ ~16 FPSï¼ˆåŠ ä¸Š preprocess + postprocess + memcpy é–‹éŠ·åˆç†ï¼‰ã€‚

  ---
  Batch 8 Frames çš„å¯è¡Œæ€§

  å¥½æ¶ˆæ¯ï¼šVision Encoder å·²ç¶“æ”¯æ´

  ä½ çš„ onnx_to_tensorrt.sh å·²ç¶“æŠŠ vision encoder å»ºæˆ maxShapes=8x3x1008x1008ï¼š

  # å·²ç¶“å­˜åœ¨çš„è¨­å®š
  --minShapes=images:1x3x1008x1008
  --optShapes=images:8x3x1008x1008    # â† opt å°±æ˜¯ 8ï¼
  --maxShapes=images:8x3x1008x1008    # â† max ä¹Ÿæ˜¯ 8

  æ‰€ä»¥ vision encoder ç¾åœ¨å°±èƒ½ä¸€æ¬¡åƒ 8 å¼µåœ–ï¼Œä¸ç”¨é‡å»ºå¼•æ“ã€‚

  å£æ¶ˆæ¯ï¼šDecoder çš„ batch ç¶­åº¦æœ‰è¡çª

  ç›®å‰ decoder çš„ batch ç¶­åº¦æ˜¯æ‹¿ä¾†åš multi-class çš„ï¼š

  ç¾ç‹€: decoder batch = N (class æ•¸)
        4 classes â†’ batch=4

  8 frames éœ€è¦: decoder batch = 8 frames Ã— N classes = 32
        è€Œ maxShapes åªæœ‰ 8

  è¦æ”¯æ´å°±å¾—é‡å»º decoder engineï¼ŒæŠŠ maxShapes æ‹‰åˆ° 32 æˆ–æ›´é«˜ï¼Œä½†é€™æœƒåƒæ›´å¤š VRAMã€‚

  ---
  æ•ˆèƒ½èƒ½æå‡å¤šå°‘ï¼Ÿ

  é€™æ˜¯é‡é» â€” batching ä¸æ˜¯ç·šæ€§çš„ï¼Œä½†ç¢ºå¯¦æœ‰å¹«åŠ©ï¼š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚      å ´æ™¯      â”‚ Vision Encoder  â”‚    Decoder     â”‚    æ¯å¹€å»¶é²    â”‚ ç­‰æ•ˆ FPS â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ ç¾ç‹€ (1 frame) â”‚ 32ms Ã— 1        â”‚ 14ms Ã— 1       â”‚ ~47ms          â”‚ ~21      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Batch 8 frames â”‚ ~80-120ms total â”‚ ~40-60ms total â”‚ ~15-22ms/frame â”‚ ~45-65   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  ç‚ºä»€éº¼ä¸æ˜¯ 8Ã— åŠ é€Ÿï¼Ÿ

  Vision Encoder æ˜¯ ViTï¼ˆTransformerï¼‰ï¼Œå®ƒçš„ç“¶é ¸æ˜¯ï¼š
  - Memory bandwidthï¼š8 å¼µ 1008Ã—1008 åœ–çš„ FPN è¼¸å‡º = 256Ã—288Ã—288Ã—4bytesÃ—8 = ~610MB å…‰ fpn_feat_0 ä¸€å±¤
  - è¨ˆç®—é‡ï¼šself-attention æ˜¯ O(nÂ²)ï¼Œpatch æ•¸ä¸è®Šä½† batch å¢åŠ æœƒè®“ GPU SM æ›´é£½å’Œ
  - é€šå¸¸ 2-4Ã— ç¸½ååé‡æå‡æ˜¯åˆç†é æœŸï¼ˆä¸æ˜¯ 8Ã—ï¼‰ï¼Œå› ç‚º GPU åœ¨ batch=1 æ™‚å°±ä¸æ˜¯å®Œå…¨é–’ç½®

  ç®—æ•¸ç¾å¯¦

  8 cameras Ã— 30 FPS = éœ€è¦ 240 FPS ç¸½åå
  ç›®å‰å–®å¹€: ~16 FPS
  batch å„ªåŒ–å¾Œå¯èƒ½: ~45-65 FPS
  â†’ æ¯æ”¯æ”å½±æ©Ÿåªèƒ½åˆ†åˆ° ~5-8 FPS

  **çµè«–ï¼šç´”é  batch ç„¡æ³•è®“ 8 æ”¯ 30FPS æ”å½±æ©Ÿå…¨éƒ¨å³æ™‚è™•ç†ã€‚**ä½†ä½ ä¹Ÿèªªäº†ï¼Œä½ ä¸éœ€è¦æ¯å¹€éƒ½è¾¨è­˜ â€” 16 FPS çš„ inference speed åœ¨
  30 FPS çš„ stream ä¸Šæœ¬ä¾†å°±æœƒè‡ªç„¶ skip framesã€‚

  ---
  å¯¦éš›å¯è¡Œçš„æ¶æ§‹æ–¹æ¡ˆ

  æ–¹æ¡ˆ 1ï¼šVision Encoder Batchingï¼ˆæœ€å®¹æ˜“ï¼‰

  åªæ”¹ vision encoder çš„éƒ¨åˆ†ï¼Œdecoder ä»ç„¶é€å¹€è·‘ï¼š

  8 cameras å„å– 1 frame
          â†“
  Vision Encoder: batch=8, ä¸€æ¬¡è·‘ (~100ms)
          â†“
  8 çµ„ FPN features
          â†“
  Decoder: é€å¹€è·‘ (8 Ã— ~14ms = ~112ms)
          â†“
  æ¯ ~212ms å®Œæˆä¸€è¼ª 8 å¹€ â†’ ~4.7 FPS/camera

  å„ªé»ï¼šä¸ç”¨é‡å»º decoder engineï¼Œæ”¹å‹•æœ€å°
  ç¼ºé»ï¼šååé‡æå‡æœ‰é™

  æ–¹æ¡ˆ 2ï¼šFull Batchï¼ˆéœ€é‡å»º engineï¼‰

  é‡å»º decoder engine: maxShapes batch=32 (æˆ– 64)

  8 cameras å„å– 1 frame
          â†“
  Vision Encoder: batch=8 (~100ms)
          â†“
  FPN d2d replicate: æ¯å¹€çš„ FPN è¤‡è£½ N ä»½ â†’ 8N ä»½
          â†“
  Decoder: batch=8N (~40-60ms for 32 batch)
          â†“
  æ¯ ~160ms å®Œæˆä¸€è¼ª 8 å¹€ â†’ ~6.25 FPS/camera

  å„ªé»ï¼šdecoder ä¹Ÿä¸¦è¡ŒåŒ–
  ç¼ºé»ï¼šVRAM éœ€æ±‚æš´å¢ï¼ˆpred_masks: [32, 200, 288, 288] â‰ˆ 19GB å…‰ mask bufferï¼‰

  æ–¹æ¡ˆ 3ï¼šDeepStream é¢¨æ ¼ â€” Pipeline Parallelism + CUDA Multi-Stream

  Stream A (å¶æ•¸å¹€):  VE frame 0,2,4... â†’ Decoder frame 0,2,4...
  Stream B (å¥‡æ•¸å¹€):  VE frame 1,3,5... â†’ Decoder frame 1,3,5...
                       â†‘                    â†‘
              å…©å€‹ CUDA stream åŒæ™‚è·‘åœ¨ GPU ä¸Š

  ç”¨ 2-4 å€‹ CUDA streamï¼Œè®“ vision encoder å’Œ decoder çš„ kernel å¯ä»¥é‡ç–ŠåŸ·è¡Œã€‚é€™å°±æ˜¯ DeepStream mux çš„æ ¸å¿ƒæ€æƒ³ â€”
  ä¸æ˜¯ç­‰ä¸€å¹€è·‘å®Œå†è·‘ä¸‹ä¸€å¹€ï¼Œè€Œæ˜¯ç®¡ç·šåŒ–ã€‚

  å„ªé»ï¼šä¸éœ€è¦è¶…å¤§ batchï¼ŒVRAM å¯æ§ï¼Œå»¶é²ä½
  ç¼ºé»ï¼šå¯¦ä½œæœ€è¤‡é›œï¼Œè¦ç®¡ç†å¤šå€‹ execution context

  æ–¹æ¡ˆ 4ï¼šå‹™å¯¦ç­–ç•¥ï¼ˆæ¨è–¦èµ·æ‰‹ï¼‰

  # æ¯æ”¯æ”å½±æ©Ÿä¸éœ€è¦ 30FPS è¾¨è­˜ï¼Œé™åˆ° 5-8 FPS å°±å¤ äº†
  # 8 cameras Ã— 6 FPS = 48 FPS éœ€æ±‚
  # é€™åœ¨ batch=8 vision encoder çš„æƒ…æ³ä¸‹æ˜¯å¯èƒ½çš„

  class MultiStreamPipeline:
      def __init__(self, num_cameras=8):
          self.pipe = Pipeline("config.json")
          # Round-robin: æ¯æ¬¡è™•ç† 1 å€‹ camera çš„æœ€æ–° frame
          # 8 å€‹ camera è¼ªä¸€åœˆ = 8 Ã— ~47ms = ~376ms
          # â†’ æ¯æ”¯ camera ~2.7 FPS (ä¸ batch)
          # â†’ ç”¨ batch=8 â†’ æ¯è¼ª ~160ms â†’ ~6.25 FPS/camera âœ“

  ---
  VRAM ä¼°ç®—
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚     é…ç½®      â”‚ Vision Encoder Input â”‚ FPN Buffers â”‚ Decoder Output â”‚ é ä¼°è¿½åŠ  VRAM â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ ç¾ç‹€ batch=1  â”‚ 12MB                 â”‚ ~700MB      â”‚ ~2.5GB         â”‚ åŸºç·š          â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ VE batch=8    â”‚ 97MB                 â”‚ ~5.5GB      â”‚ ~2.5GB         â”‚ +~5GB         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Full batch=32 â”‚ 97MB                 â”‚ ~5.5GB      â”‚ ~19GB masks    â”‚ +~22GB        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Full batch åœ¨å–®å¼µ GPU ä¸Šå¹¾ä¹ä¸å¯èƒ½ï¼ˆé™¤éä½ æœ‰ A100 80GB æˆ– H100ï¼‰ã€‚Vision Encoder åªåš batch æ˜¯æœ€å‹™å¯¦çš„ã€‚

  ---
  ç¸½çµ
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚               å•é¡Œ               â”‚                                  å›ç­”                                   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 8 frames åŒæ™‚ inference å¯ä»¥å—ï¼Ÿ â”‚ Vision encoder: å¯ä»¥ï¼Œengine å·²ç¶“æ”¯æ´ batch=8                           â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ æœƒæé«˜é€Ÿåº¦å—ï¼Ÿ                   â”‚ æœƒï¼Œä½†ä¸æ˜¯ 8Ã—ï¼Œé ä¼° 2-4Ã— ååé‡æå‡                                     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ çµæ§‹æ€§ç“¶é ¸ï¼Ÿ                     â”‚ Decoder çš„ batch ç¶­åº¦è¢« class ä½”äº†ï¼Œmask buffer å·¨å¤§                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ æœ€å¤§é˜»åŠ›ï¼Ÿ                       â”‚ VRAM â€” mask è¼¸å‡º [B, 200, 288, 288] å¤ªå¤§                                â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ æ¨è–¦èµ·æ‰‹ï¼Ÿ                       â”‚ æ–¹æ¡ˆ 4ï¼šbatch vision encoder + round-robin camerasï¼Œç›®æ¨™ 5-8 FPS/camera â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  å¦‚æœä½ å¯¦éš›ä¸éœ€è¦ maskï¼ˆVisionDSL åªç”¨ bboxï¼‰ï¼Œå¯ä»¥è€ƒæ…®æ‹†å‡ºä¸€å€‹ä¸ç”Ÿæˆ mask çš„ decoderï¼ŒVRAM æœƒå¤§å¹…é™ä½ï¼Œbatch
  å°±èƒ½æ‹‰æ›´é«˜ã€‚è¦é€²ä¸€æ­¥æ¢è¨å“ªå€‹æ–¹æ¡ˆçš„è©±è·Ÿæˆ‘èªªã€‚
